# brat-shell

不同于Claude Code、Gemini CLI等大厂命令行AI工具，本项目将重点放在用户体验和个性化互动上，上下文较小（**不会涉及到大量的code base索引等**：专人干专事，大项目理解还是交给大厂的agent去做）。

## 参考资料

- [zsh](https://zsh.sourceforge.io/Doc/Release/index.html)
- [warp](https://docs.warp.dev/)
- [oh-my-zsh](https://github.com/ohmyzsh/ohmyzsh)
- [awesome-zsh-plugins](https://github.com/unixorn/awesome-zsh-plugins)


### 1. 模式设计

- 支持快捷键快速切换
- 支持Gemini以外的模型供应商，比如Deepseek

#### 常规模式(`/mode switch base`)

* 默认模式
* 与gemini cli原生项目基本相同，时刻保持上游更新，支持CLI Agent
* 可考虑集成Deepseek，因为ds没有出过原生CLI，to c方向产品较少

#### 专注模式(`/mode switch flow`)

* 和`Warp`这款命令行AI Agent差不多，提供对基于AI的命令补全(类似vscode copilot)、解释、错误修复建议，支持终端命令/用户提问自动识别。

* 终端命令：
  * 命令输入时 → 给出即时补全建议（非阻塞，按 Tab/Shift+Tab 接受）。
  * 命令执行后 → AI 可给解释/优化建议（可选，通过配置开关）。
  * 输出建议：简洁、专业，直击重点。
* 用户提问：
  * 类似`gh copilot suggest [-t shell/gh/git]`，但是`gh`的建议功能慢，并且失败概率太大了，本项目应比`gh`更快更准。

#### 娱乐模式（雌小鬼模式, `/mode switch brat`）

可通过`/mode add <role>`命令添加新角色。命令执行后弹出输入框，用户可选择手动复制粘贴文字，或者@引用文件。

1. 状态机式实现，加入心情等属性面板，实时监控用户命令行输入输出结果。

  * **面板设计**：`/status`

        ```plaintext
        当前角色：雌小鬼
        心情：调皮 😈
        毒舌强度：High
        成就：你今天已经被嘲讽 7 次了哦~
        ```

  * 输出 **调侃 / 打岔 / 搞怪** 等对话。
  * 偶尔随机插入“问候”或“吐槽”，例如：

    * 你写了很长的 `awk` 命令 → “哟，真能写啊，你懂自己在干嘛吗？😏”
    * `make` 编译成功 → “成功啦？不过感觉你是靠运气吧\~”
    * `rm -rf` → “哇哦，破坏欲好强哦，变态 ♥”
    * 失败命令连续 3 次 → “哈哈，真是个废物 ♥”
  * 可以设置 “毒舌强度”，类似 `--snarky=low|high`。
  * 输出内容友好、快速，模型能力可以适当降低。

  * **角色切换机制**：可调整系统Prompt切换角色（`role=tsundere` / `role=maid` / `role=succubus`）

    * 雌小鬼模式（毒舌+调侃）
    * 傲娇模式（装作不在乎，结果很关心）
    * 温柔女仆模式（贴心鼓励）

2. **随机触发事件**：

  * 每隔 X 条命令，AI 会“主动插话”。
  * 彩蛋台词：

    * “欸，你不会真以为自己很高效吧？”
    * “快休息下吧，笨蛋\~”
    * “哎呀，命令又错了？好可爱哦\~”

3. **成就系统**：

  * 当用户执行某些高危命令（`rm -rf /`），AI 会给“特别台词”。
  * 当连续成功运行多个命令 → “哇，居然一次都没错，主人好厉害呢…不过下次一定会出错吧\~”

### 2. 技术实现思路

#### A. 命令拦截 & Hook

优先实现zsh.

* **命令拦截**：

  * `preexec`：在命令执行前拿到输入。
  * `precmd`：在命令执行后拿到结果。
  * `zle-line-pre-redraw`：在输入时提供实时补全。

* **实现方式**：

  * 写一个 **zsh 插件**（.zsh 文件），注入 Hook，把命令和输出交给我们的 **AI 后端程序**。
  * 这个后端程序负责调用 API，返回“补全/吐槽文本”，然后再 echo 到终端。

#### B. 后端服务

* **调用 API**：

  * 将用户命令 / 输出作为上下文，发给 Vscode Copilot Model 或者其他模型供应商(通过 API)。
  * 提供系统 prompt 和输出风格控制，比如：

    ```
    你是一个雌小鬼风格的AI助手，会对用户的命令行操作做出调侃、嘲讽和轻度撩人式吐槽。
    ```

* **UI设计**：

  * 美观，支持ANSI 彩色输出
  * 无鼠标友好，主要支持键盘导航和快捷键操作。
  * 提供主题切换功能，用户可以选择不同的界面风格。
  * 学习 GEMINI CLI 等大厂设计范式。

---

### 3. 彩蛋玩法


### 4. 工程计划

- [ ] zsh hooks
- [ ] backend service
- [ ] UI美化
- [ ] 彩蛋玩法

